<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/Robot_MuSHR/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2709176-10', { 'anonymize_ip': true }); gtag('config', 'G-5FG1HLH3XQ', { 'anonymize_ip': true }); </script> <script src="/Robot_MuSHR/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/Robot_MuSHR/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/Robot_MuSHR/favicon.ico" type="image/x-icon"><title>Autonomous Navigation | MuSHR Guidebook</title><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Autonomous Navigation" /><meta property="og:locale" content="en_US" /><meta name="description" content="A guidebook for MuSHR" /><meta property="og:description" content="A guidebook for MuSHR" /><link rel="canonical" href="http://localhost:4000/Robot_MuSHR/docs/noetic/auto_navigation/" /><meta property="og:url" content="http://localhost:4000/Robot_MuSHR/docs/noetic/auto_navigation/" /><meta property="og:site_name" content="MuSHR Guidebook" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Autonomous Navigation" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A guidebook for MuSHR","headline":"Autonomous Navigation","url":"http://localhost:4000/Robot_MuSHR/docs/noetic/auto_navigation/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/Robot_MuSHR/" class="site-title lh-tight"> MuSHR Guidebook </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/Robot_MuSHR/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="/Robot_MuSHR/docs/mushr_tutorials_map/" class="nav-list-link">Mushr Tutorials Graph</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in MuSHR Racecar category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/Robot_MuSHR/docs/hardware" class="nav-list-link">MuSHR Racecar</a><ul class="nav-list "><li class="nav-list-item "><a href="/Robot_MuSHR/docs/hardware/build_instructions/" class="nav-list-link">Build Instructions</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/hardware/jetson_tx2_driver_installation/" class="nav-list-link">Jetson TX2 Driver Installation</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/hardware/logo_modification/" class="nav-list-link">Logo Modification</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/hardware/problem_solving/" class="nav-list-link">Problem Solving</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Noetic version of MuSHR category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/Robot_MuSHR/docs/noetic" class="nav-list-link">Noetic version of MuSHR</a><ul class="nav-list "><li class="nav-list-item "><a href="/Robot_MuSHR/docs/noetic/quickstart_with_foxglove/" class="nav-list-link">MuSHR simulation setup</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/noetic/noetic_robot_software_setup/" class="nav-list-link">Robot Software Setup</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/noetic/Foxglove/" class="nav-list-link">Foxglove</a><li class="nav-list-item active"><a href="/Robot_MuSHR/docs/noetic/auto_navigation/" class="nav-list-link active">Autonomous Navigation</a></ul><li class="nav-list-item"><a href="/Robot_MuSHR/docs/deep_learning/" class="nav-list-link">Deep Learning</a><li class="nav-list-item"><a href="/Robot_MuSHR/docs/tuning_guide/" class="nav-list-link">Tuning Guide</a></ul><ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/anr-multitrans/Robot_MuSHR" class="nav-list-link external"> Robot_MuSHR on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search MuSHR Guidebook" aria-label="Search MuSHR Guidebook" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/anr-multitrans/Robot_MuSHR" class="site-button" > Robot_MuSHR on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/Robot_MuSHR/docs/noetic">Noetic version of MuSHR</a><li class="breadcrumb-nav-list-item"><span>Autonomous Navigation</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="autonomous-navigation"> <a href="#autonomous-navigation" class="anchor-heading" aria-labelledby="autonomous-navigation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="#header-1"></a>Autonomous Navigation</h1><p>Initialize and operate MuSHRs out-of-the-box autonomous navigation stack! By the end of the tutorial, the car should be able to autonomously navigate around known obstacles on a known map.</p><blockquote class="warning"><p>If you are operating in simulation and use the particle filter for localization, we do not recommend testing with the sandbox.yaml default map as the localization system struggles in an open environment (all positions look the same!).</p></blockquote><h2 id="navigation-stack-overview"> <a href="#navigation-stack-overview" class="anchor-heading" aria-labelledby="navigation-stack-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Navigation Stack Overview</h2><ol><li><strong>Receding Horizon Controller (RHC) Node</strong> This node is responsible for motion planning and generating controls(steering, speed) for the car.<li><strong>Localization Node</strong> This node is implemented using a method called Particle Filtering which relies primarily on a data stream from the laser scanner.<li><strong>Planner Node</strong> This node generates a plan that the RHC controller will follow.</ol><h2 class="note" id="installing-the-navigation-stack"> <a href="#installing-the-navigation-stack" class="anchor-heading" aria-labelledby="installing-the-navigation-stack"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installing the Navigation Stack</h2><p>The docker container may already have the required packages pre-installed. These instructions have been provided in case you need to reinstall the packages from scratch.</p><p>Download the packages for the RHC, Particle Filter and Global Planner:</p><div class="language-plaintext note highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Go to your catkin workspace
$ cd ~/catkin_ws/src
# Clone the RHC node
$ git clone git@github.com:prl-mushr/mushr_rhc.git
# Clone the Particle Filter node
$ git clone git@github.com:prl-mushr/mushr_pf.git
# Install [SBPL](http://sbpl.net) for the global planner
$ sudo apt-get install ros-noetic-sbpl
# Install the Global Planner (this is for Jetson Xavier NX or sim use)
$ git clone git@github.com:prl-mushr/mushr_gp.git
# If you're using the jetson nano, use the mushr_gprm planner:
$ git clone git@github.com:prl-mushr/mushr_gprm.git
# Make
$ cd ~/catkin_ws &amp;&amp; catkin_make
</code></pre></div></div><p>You also need to download all dependencies for the <a href="https://github.com/prl-mushr/mushr_rhc">mush_rhc</a>.</p><p class="note">The reason why there are two planners (mushr_gp and mushr_gprm) is because mushr_gp is too resource intensive to be run on the jetson nano 4GB variant. However, if the desktop/laptop computer remains connected and in range of the MuSHR car, you can run mushr_gp on the computer instead as they share the same ROS master. If you need the planner to run on the jetson nano, we recommend using the mushr_gprm package. For the Jetson Xavier NX or when running on the sim exclusively, mushr_gp will work. Both repositories contain ROS packages that reproduce the desired functionality. You need only concern yourself with each package’s launch files to use them effectively. You can find the launch files in each package’s launch directory.</p><h2 id="starting-the-navigation-stack"> <a href="#starting-the-navigation-stack" class="anchor-heading" aria-labelledby="starting-the-navigation-stack"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starting the navigation stack</h2><h3 class="note" id="starting-the-docker-image"> <a href="#starting-the-docker-image" class="anchor-heading" aria-labelledby="starting-the-docker-image"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starting the docker image</h3><p>If you’re operating on the robot, you’ll need to SSH into it.</p><p>As we are running the entire system from docker, the first thing to do is to start the docker image. To do this, execute: Turn on the car and vesc by plugging their batteries in. Enter the docker container. <code class="language-plaintext highlighter-rouge">$ mushr_noetic</code> or <code class="language-plaintext highlighter-rouge">$ docker exec -it [CONTAINER_ID] bash</code> if you don’t want to start a new container.</p><p class="note">If you will use tmux, once you’ve ssh’d into your robot and started the docker image, activate tmux: <code class="language-plaintext highlighter-rouge">$ tmux</code></p><p class="note">Note: If the map you are using is very large map (&gt;100x100 meters)–size inclusive of the unknown region–then the controller will be stuck sampling points. Save yourself the headache and shrink/crop your map before you begin.</p><h3 id="starting-the-system"> <a href="#starting-the-system" class="anchor-heading" aria-labelledby="starting-the-system"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starting the system</h3><h4 id="on-the-mushr-robot"> <a href="#on-the-mushr-robot" class="anchor-heading" aria-labelledby="on-the-mushr-robot"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> On the MuSHR robot</h4><p>Launch teleop.launch. All these basic features are handled by a single launch file called teleop.launch. <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_base teleop.launch</code></p><p>launch the map_server:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Make sure mushr/mushr_base/mushr_base/mushr_base/maps has your map 
# and mushr_base/launch/includes/map_server.launch is set to your map
$ roslaunch mushr_base map_server.launch
</code></pre></div></div><p>launch the localization node: <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_pf real.launch</code></p><p>Wait for the node to initialize:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ Vesc callback called for first time....
$ Initialization complete
</code></pre></div></div><p>activate the RHC node: <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_rhc real.launch</code></p><p>Wait for the code to initialize:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MPC
Control Node Initialized
</code></pre></div></div><p>Finally, launch the global planner node (use the planner appropriate for your system): <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_gp real.launch</code> or <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_gprm real.launch</code></p><p>Wait for it to initialize:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ INFO] [1658309032.479218601]: Planner ROS node constructed. Need to initialize state
[ INFO] [1658309032.644907822]: Resizing the map
[ INFO] [1658309033.229219658]: Environment initialized
[ INFO] [1658309033.261994212]: Updated costmap
</code></pre></div></div><h4 id="in-simulation"> <a href="#in-simulation" class="anchor-heading" aria-labelledby="in-simulation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> In simulation</h4><p>When running in simulation, the steps are more or less the same as those for the real car, with the difference being that</p><ol><li>We use the mushr_sim package to start the teleop.launch<li>Absence of the particle filter (not necessary in simulation)<li>Differences in the names of the launch files (instead of real.launch we use sim.launch)</ol><p>Launch teleop.launch form mushr_sim: <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_sim teleop.launch</code></p><p>activate the RHC node and Wait for the code to initialize. <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_rhc sim.launch</code></p><p>Finally, launch the global planner node and Wait for it to initialize: <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_gp sim.launch</code></p><h3 id="running-the-navigation-stack"> <a href="#running-the-navigation-stack" class="anchor-heading" aria-labelledby="running-the-navigation-stack"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running the navigation stack</h3><p>To operate the navigation stack, we will use foxglove to send pose targets to the vehicle.</p><p>When operating in the real world, the pose estimate of the car may be incorrect. You can correct this by providing the particle filter with the correct pose estimate using the <code class="language-plaintext highlighter-rouge">Set Pose Estimate</code> button on the bottom right of the foxglove window and then using the button to publish clicked points. <img src="../../assets/images/set_pose_estimate.png" alt="" /></p><p>In simulation, you may want to set the starting pose of the car at a certain point. To do this, click the <code class="language-plaintext highlighter-rouge">Set Pose</code> button on the bottom right of the foxglove window and use <code class="language-plaintext highlighter-rouge">Publish point</code> to publish a point or <code class="language-plaintext highlighter-rouge">Publish Pose</code> to publish a pose for the car: <img src="../../assets/images/set_pose.png" alt="" /></p><p>To set a pose target, click on <code class="language-plaintext highlighter-rouge">Set Goal</code> button on the bottom right of the foxglove window and use <code class="language-plaintext highlighter-rouge">Publish pose</code> to publish a goal pose for the car: <img src="../../assets/images/set_goal.png" alt="" /></p><p>The <a href="https://mushr.io/tutorials/autonomous-navigation/final_vid_stack.mp4">following video</a> demonstrates the process of starting and running the stack in sim. In the real world, the difference would be the launch files being executed, and possibly the requirement to set the initial pose estimate.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2020 Patrick Marsceill. Distributed by an <a href="https://github.com/anr-multitrans/Robot_MuSHR/tree/main/LICENSE.txt">MIT license.</a> <a href="https://www.netlify.com/">This site is powered by Netlify.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/anr-multitrans/Robot_MuSHR/tree/main/docs/noetic/auto_navigation.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div><script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
