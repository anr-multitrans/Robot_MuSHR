<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/Robot_MuSHR/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2709176-10', { 'anonymize_ip': true }); gtag('config', 'G-5FG1HLH3XQ', { 'anonymize_ip': true }); </script> <script src="/Robot_MuSHR/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/Robot_MuSHR/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/Robot_MuSHR/favicon.ico" type="image/x-icon"><title>Tuning Guide | MuSHR Guidebook</title><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Tuning Guide" /><meta property="og:locale" content="en_US" /><meta name="description" content="A guidebook for MuSHR" /><meta property="og:description" content="A guidebook for MuSHR" /><link rel="canonical" href="http://localhost:4000/Robot_MuSHR/docs/tuning_guide/" /><meta property="og:url" content="http://localhost:4000/Robot_MuSHR/docs/tuning_guide/" /><meta property="og:site_name" content="MuSHR Guidebook" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Tuning Guide" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A guidebook for MuSHR","headline":"Tuning Guide","url":"http://localhost:4000/Robot_MuSHR/docs/tuning_guide/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/Robot_MuSHR/" class="site-title lh-tight"> MuSHR Guidebook </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/Robot_MuSHR/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="/Robot_MuSHR/docs/mushr_tutorials_map/" class="nav-list-link">Mushr Tutorials Graph</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in MuSHR Racecar category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/Robot_MuSHR/docs/hardware" class="nav-list-link">MuSHR Racecar</a><ul class="nav-list "><li class="nav-list-item "><a href="/Robot_MuSHR/docs/hardware/build_instructions/" class="nav-list-link">Build Instructions</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/hardware/jetson_nano_driver_installation/" class="nav-list-link">Jetson TX2 Driver Installation</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/hardware/logo_modification/" class="nav-list-link">Logo Modification</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Noetic version of MuSHR category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/Robot_MuSHR/docs/noetic" class="nav-list-link">Noetic version of MuSHR</a><ul class="nav-list "><li class="nav-list-item "><a href="/Robot_MuSHR/docs/noetic/quickstart_with_foxglove/" class="nav-list-link">MuSHR simulation setup</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/noetic/noetic_robot_software_setup/" class="nav-list-link">Robot Software Setup</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/noetic/Foxglove/" class="nav-list-link">Foxglove</a><li class="nav-list-item "><a href="/Robot_MuSHR/docs/noetic/auto_navigation/" class="nav-list-link">Autonomous Navigation</a></ul><li class="nav-list-item"><a href="/Robot_MuSHR/docs/deep_learning/" class="nav-list-link">Deep Learning</a><li class="nav-list-item active"><a href="/Robot_MuSHR/docs/tuning_guide/" class="nav-list-link active">Tuning Guide</a></ul><ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/anr-multitrans/Robot_MuSHR" class="nav-list-link external"> Robot_MuSHR on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search MuSHR Guidebook" aria-label="Search MuSHR Guidebook" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/anr-multitrans/Robot_MuSHR" class="site-button" > Robot_MuSHR on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><h1 id="tuning-guide"> <a href="#tuning-guide" class="anchor-heading" aria-labelledby="tuning-guide"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tuning Guide</h1><p>The alignment of the hardware is critical for them to be able to work. With increased use, there will be some looseness or misalignment on the race car. Regular adjustments are very important, especially if you find that it doesn’t work well no matter what. If incorrectly tuned, the commands applied by your autonomous controller may not correspond to what’s being executed on the physical hardware, making it difficult to debug issues with the controller.</p><p><strong>Requirements</strong></p><ol><li>A computer that can ssh into your car.<li>A tape measure.<li>Find a relatively open space to run your car. We’ll be driving it straight for ~9ft (3m) and turning in a semi-circle of diameter ~6ft (2m).</ol><p>The file will be located at: <code class="language-plaintext highlighter-rouge">~/catkin_ws/src/mushr_base/vesc/vesc_main/config/racecar-uw-nano/vesc.yaml.</code></p><p>The file will look like this:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># erpm (electrical rpm) = speed_to_erpm_gain * speed (meters / second) + speed_to_erpm_offset</span>
<span class="c1">#-4614</span>
<span class="na">speed_to_erpm_gain</span><span class="pi">:</span> <span class="s">-2000</span>
<span class="na">speed_to_erpm_offset</span><span class="pi">:</span> <span class="m">0.0</span>

<span class="pi">[</span><span class="nv">...omited for brevity</span><span class="pi">]</span>

<span class="c1"># servo value (0 to 1) =  steering_angle_to_servo_gain * steering angle (radians) + steering_angle_to_servo_offset</span>
<span class="na">steering_angle_to_servo_gain</span><span class="pi">:</span> <span class="m">1.2135</span>
<span class="na">steering_angle_to_servo_offset</span><span class="pi">:</span> <span class="m">0.55</span>
</code></pre></div></div><h2 id="steering-angle-offset"> <a href="#steering-angle-offset" class="anchor-heading" aria-labelledby="steering-angle-offset"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Steering Angle Offset</h2><p>This offset sets the default servo position when the car is driving straight. You will be changing the variable: <code class="language-plaintext highlighter-rouge">steering_angle_to_servo_offset</code>.</p><p><strong>Tuning loop:</strong> While the car doesn’t drive straight, do the following procedure:</p><ol><li>Start teleop: <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_base teleop.launch</code><li>Drive car in a straight line a few times. It’s never going to be perfectly straight, so as long as it goes straight most of the time, it’ll be fine.<li>Adjust steering_angle_offset in vesc.yaml. Increase the offset if the car veers too much left, decrease if it veers too much right.<li>Stop teleop (Ctrl-C in the window you started teleop.launch in) and go back to Step 1.</ol><p class="note">Usually this value is between 0.4 and 0.6</p><h2 id="speed-to-erpm-gain"> <a href="#speed-to-erpm-gain" class="anchor-heading" aria-labelledby="speed-to-erpm-gain"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Speed to ERPM Gain</h2><p>This gain converts velocity to ERPM. You will be changing the variable: <code class="language-plaintext highlighter-rouge">speed_to_erpm_gain</code>.</p><p class="note">The conversion from velocity to ERPM and steering angle to servo position is a linear function of the input command: output = f(command) = gain * command + bias</p><p><strong>Before tuning:</strong>Extend your tape measure to around 9-10 ft on the floor. <img src="../assets/images/start.jpg" alt="" /></p><p><strong>Tuning loop:</strong></p><ol><li>Place car at the base of the tape measure with the back wheelbase (indicated with a white line) lined up with 0. ~<a href="../assets/images/base_with_line.jpg"></a><li>Start teleop. <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_base teleop.launch</code><li>Open another terminal on the car and run the command: <code class="language-plaintext highlighter-rouge">$ rostopic echo /car/vesc/odom/pose/pose/position/x</code> This will echo all the odometry information – how far the car has driven (in meters) in the x direction since teleop started. The value should be 0.0 at the start, as the car hasn’t moved yet.<li>Drive the car forward about 7-8 ft. The car will drive slightly further as it decelerates and stops. Make sure you only drive forward, not altering the servo position, otherwise you’ll have both x and y directional changes.<li>Record the distance traveled and convert to meters.<li>Compare to output of the rostopic echo command’s x value. If the reported distance traveled is larger than the actual, decrease the gain. If the reported distance is smaller, increase the gain. At the begining increasing or decreasing by 500 should allow you to quickly hone in on the value.<li>Stop teleop. Go back to step 1 if the values are not sufficiently close (within 2-3 cm).</ol><p class="note">This value can vary, but it should be on the order of thousands (2000-5000)</p><h2 id="steering-angle-gain"> <a href="#steering-angle-gain" class="anchor-heading" aria-labelledby="steering-angle-gain"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Steering Angle Gain</h2><p>This gain takes a steering angle in radians and converts it to a servo position. You will be changing the variable: <code class="language-plaintext highlighter-rouge">steering_angle_to_servo_gain</code>.</p><p>In order to find the desired turn radius, we look to the <a href="https://github.com/prl-mushr/mushr/blob/master/mushr_description/kinematic_car_model.pdf">kinematic car model</a>. At low enough speeds (avoiding slipping and skidding) this model farily accurately represents the movement of the car. The turn radius is: <code class="language-plaintext highlighter-rouge">R = L/2sin(beta)</code>, where L is the length of the car (0.3 meters), and beta is <code class="language-plaintext highlighter-rouge">arctan(1/2 * tan(delta))</code>, where delta is the steering angle. We will be setting the steering angle to the max (0.34 by default).</p><p>We will instead the length of a half cirlce, so 2 * R. Calculting this with the defaults, comes out to 1.722 meters (67.79 inches). If you tweak the max steering angle, or change the chassis, you will have to recompute this number.</p><p>There are two links can fate your caculating:</p><ul><li><a href="https://www.calculatorsoup.com/calculators/conversions/angle.php">Angle Conversion Calculator</a><li><a href="https://www.symbolab.com/solver/equation-calculator/%5Cfrac%7B0.44%7D%7B2%5Ccdot%20sin%5Cleft(arctan%5Cleft(%20%5Cfrac%7Btan%5Cleft(0.34%5Cright)%7D%7B2%7D%5Cright)%5Cright)%7D%5Ccdot2?or=input">Equation Calculator</a></ul><p><strong>Before tuning:</strong> Extend your tape measure to around 7-8 ft on the floor.</p><p><strong>Tuning loop:</strong></p><ol><li>Place car at the base of the tape measure with the back wheelbase (indicated with a white line) lined up with 0. <img src="../assets/images/start%20(1).jpg" alt="" /><li>Start teleop. <code class="language-plaintext highlighter-rouge">$ roslaunch mushr_base teleop.launch</code><li>Command the steering wheel max in whichever direction the measurement tape is. (Left and right are to be done separately)<li>Run the car such that the car has run over the tape and the back wheel is on the tape (see image). ~<a href="../assets/images/end.jpg"></a><li>Record the distance. The goal distance is 1.722 meters (67.79 inches). If it overshot, increase the gain, if it undershot, decrease the gain.</ol><p class="note">This value should be around 1.1-1.3</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2020 Patrick Marsceill. Distributed by an <a href="https://github.com/anr-multitrans/Robot_MuSHR/tree/main/LICENSE.txt">MIT license.</a> <a href="https://www.netlify.com/">This site is powered by Netlify.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/anr-multitrans/Robot_MuSHR/tree/main/docs/tuning_guide.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div><script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
